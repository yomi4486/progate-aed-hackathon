# 実装計画

## フェーズ 1: 基盤インフラ構築 (並列実行可能)

- [ ] 1.1 プロジェクト構造セットアップ

  - プロジェクトディレクトリ構造を作成 (crawler/, search-api/, web/, infra/)
  - Git 設定とブランチ戦略を定義
  - _要件: 6.1_

- [ ] 1.2 Terraform モジュール基盤

  - Terraform モジュール構造を実装 (network, storage, opensearch, crawler, api)
  - 開発環境用の Terraform 設定ファイルを作成
  - _要件: 6.1, 6.2_

- [ ] 1.3 ネットワークインフラ
  - VPC、サブネット、セキュリティグループの基本インフラをデプロイ
  - NAT Gateway、Internet Gateway を設定
  - _要件: 6.1_

## フェーズ 2: ストレージ・データ基盤 (並列実行可能)

- [ ] 2.1 S3 ストレージ設定

  - S3 バケット (raw, parsed, index-ready) を Terraform で作成
  - バケットポリシーとライフサイクル設定を実装
  - _要件: 1.3, 6.1_

- [ ] 2.2 キューイングシステム

  - SQS キュー (URL 処理、インデックス処理、DLQ) を Terraform で作成
  - デッドレターキューとリトライ設定を実装
  - _要件: 3.4, 6.1_

- [ ] 2.3 DynamoDB 設定

  - DynamoDB (URL 状態管理) テーブルを Terraform で作成
  - GSI (Global Secondary Index) と TTL 設定を実装
  - _要件: 1.3, 6.1_

- [ ] 2.4 暗号化・セキュリティ
  - KMS 暗号化設定を適用
  - IAM 基本ロールとポリシーを作成
  - _要件: 6.3_

## フェーズ 3: 検索エンジン基盤

- [ ] 3.1 OpenSearch クラスター構築

  - OpenSearch クラスターを Terraform で作成 (kNN 有効化)
  - セキュリティグループとアクセス制御を設定
  - _要件: 2.1, 6.1_

- [ ] 3.2 OpenSearch インデックス設計

  - 日本語解析器 (MeCab) 設定を含むインデックスマッピングを実装
  - knn_vector フィールドを含むドキュメントスキーマを定義
  - _要件: 2.4, 3.2_

- [ ] 3.3 インデックステンプレート
  - インデックステンプレートとエイリアス設定を実装
  - ローリングインデックス戦略を設計
  - _要件: 2.1_

## フェーズ 4: クローラー開発 (並列実行可能)

- [ ] 4.1 クローラーコアエンジン

  - Python Web クローラーの基本クラス構造を実装
  - 設定管理とログ設定を実装
  - _要件: 1.1_

- [ ] 4.2 robots.txt・sitemap 処理

  - robots.txt 解析と sitemap.xml 処理機能を実装
  - URL 正規化とフィルタリング機能を実装
  - _要件: 1.1_

- [ ] 4.3 HTTP 取得エンジン

  - HTTP 取得とエラーハンドリング (リトライ、バックオフ) を実装
  - User-Agent 管理とセッション管理を実装
  - _要件: 1.4_

- [ ] 4.4 コンテンツ処理

  - HTML パース、テキスト抽出、言語判定機能を実装
  - メタデータ抽出 (title, description, published_at) を実装
  - _要件: 1.2_

- [ ] 4.5 レート制御システム
  - ドメイン別レート制御機能を実装
  - 同時接続数制御とキューイング機能を実装
  - _要件: 1.5_

## フェーズ 5: データ統合・永続化

- [ ] 5.1 S3 データ保存

  - S3 への raw/parsed データ保存機能を実装
  - データ圧縮とパーティショニング機能を実装
  - _要件: 1.3_

- [ ] 5.2 URL 状態管理

  - DynamoDB での URL 状態管理 (未訪問 → 訪問中 → 完了) を実装
  - 重複 URL 検出とコンテンツハッシュ管理を実装
  - _要件: 1.3, 8.5_

- [ ] 5.3 SQS 統合
  - SQS への URL 投入とメッセージ処理を実装
  - バッチ処理とエラーハンドリングを実装
  - _要件: 3.4_

## フェーズ 6: クローラーデプロイメント

- [ ] 6.1 Docker コンテナ化

  - Dockerfile と ECS タスク定義を Terraform で作成
  - マルチステージビルドと最適化を実装
  - _要件: 1.1, 6.1_

- [ ] 6.2 ECS クラスター設定

  - ECS クラスターと Fargate サービス設定を実装
  - Auto Scaling とサービス検出を設定
  - _要件: 6.1_

- [ ] 6.3 環境設定・権限
  - 環境変数と IAM ロール設定を実装
  - Secrets Manager 統合を実装
  - _要件: 6.3_

## フェーズ 7: ベクトル埋め込みシステム (並列実行可能)

- [ ] 7.1 Bedrock クライアント

  - Amazon Bedrock (Titan/Cohere) クライアントを実装
  - API 制限とエラーハンドリングを実装
  - _要件: 3.1_

- [ ] 7.2 テキスト前処理

  - テキストの前処理とチャンク分割機能を実装
  - 言語別の前処理ルールを実装
  - _要件: 3.1_

- [ ] 7.3 埋め込み生成バッチ
  - バッチ埋め込み生成とエラーハンドリングを実装
  - 埋め込みベクトルの正規化と圧縮機能を実装
  - _要件: 3.5_

## フェーズ 8: インデクサーサービス

- [ ] 8.1 インデクサーコア

  - SQS ポーリングベースのインデクサーメインループを実装
  - 並列処理とワーカー管理を実装
  - _要件: 3.1_

- [ ] 8.2 ドキュメント処理

  - S3 からのドキュメント読み込み機能を実装
  - Bedrock 埋め込み生成の統合を実装
  - _要件: 3.1, 3.2_

- [ ] 8.3 OpenSearch 投入

  - OpenSearch バルク投入機能を実装
  - インデックス最適化とエラー処理を実装
  - _要件: 3.2_

- [ ] 8.4 エラー処理・監視
  - エラー処理と DLQ 送信機能を実装
  - メトリクス収集とヘルスチェックを実装
  - _要件: 3.4_

## フェーズ 9: インデクサーデプロイメント

- [ ] 9.1 EC2 インフラ

  - EC2 インスタンス用の Terraform 設定を作成
  - Auto Scaling グループとロードバランサー設定を実装
  - _要件: 6.1_

- [ ] 9.2 権限・監視設定
  - IAM ロールと必要な権限を設定
  - New Relic Infrastructure エージェント設定を実装
  - _要件: 7.1, 7.2_

## フェーズ 10: 検索 API 開発 (並列実行可能)

- [ ] 10.1 FastAPI 基盤

  - FastAPI アプリケーションの基本構造を実装
  - 設定管理とミドルウェア設定を実装
  - _要件: 4.1_

- [ ] 10.2 OpenSearch 統合

  - OpenSearch クライアントとクエリビルダーを実装
  - 接続プールと接続管理を実装
  - _要件: 2.1_

- [ ] 10.3 BM25 検索機能

  - BM25 検索機能を実装
  - クエリ解析と最適化を実装
  - _要件: 2.1_

- [ ] 10.4 ベクトル検索機能

  - kNN ベクトル検索機能を実装
  - ベクトル類似度計算を実装
  - _要件: 2.1_

- [ ] 10.5 ハイブリッド検索
  - RRF (Reciprocal Rank Fusion) スコア統合を実装
  - スコア正規化とランキング調整を実装
  - _要件: 2.2_

## フェーズ 11: 検索結果処理

- [ ] 11.1 ハイライト機能

  - 検索結果のハイライト生成機能を実装
  - 多言語対応ハイライト処理を実装
  - _要件: 2.5_

- [ ] 11.2 スニペット生成

  - スニペット抽出とフォーマット機能を実装
  - 関連性スコアベースのスニペット選択を実装
  - _要件: 2.5_

- [ ] 11.3 ページング・フィルタ

  - ページング、フィルタ、ソート機能を実装
  - パフォーマンス最適化を実装
  - _要件: 4.2_

- [ ] 11.4 レスポンス最適化
  - レスポンス時間最適化を実装
  - 結果キャッシュ戦略を実装
  - _要件: 2.3_

## フェーズ 12: キャッシュシステム

- [ ] 12.1 Redis クラスター

  - ElastiCache Redis クラスターを Terraform で作成
  - レプリケーションとフェイルオーバー設定を実装
  - _要件: 2.3_

- [ ] 12.2 キャッシュ機能

  - 検索結果キャッシュ機能を実装
  - キャッシュキー戦略と TTL 管理を実装
  - _要件: 4.5_

- [ ] 12.3 キャッシュ運用
  - キャッシュ無効化とウォームアップ機能を実装
  - キャッシュヒット率監視を実装
  - _要件: 2.3_

## フェーズ 13: 検索 API デプロイメント

- [ ] 13.1 ロードバランサー設定

  - ALB + EC2 Auto Scaling の設定を Terraform で実装
  - ヘルスチェックとロードバランシング設定を実装
  - _要件: 4.3_

- [ ] 13.2 セキュリティ・制限

  - API レート制限とセキュリティ設定を実装
  - CORS 設定と API 認証を実装
  - _要件: 6.3_

- [ ] 13.3 監視統合
  - New Relic APM エージェント統合を実装
  - カスタムメトリクス収集を実装
  - _要件: 4.4_

## フェーズ 14: 型定義生成ツール

- [ ] 14.1 スキーマ解析

  - FastAPI スキーマから TypeScript 型定義を生成する Python スクリプトを実装
  - OpenAPI 仕様書解析エンジンを実装
  - _要件: 4.1_

- [ ] 14.2 TypeScript 生成

  - TypeScript インターフェース生成機能を実装
  - 型定義の検証とフォーマット機能を実装
  - _要件: 5.1_

- [ ] 14.3 CI 統合
  - CI/CD パイプラインでの自動実行設定を実装
  - 差分検知と自動 PR 作成機能を実装
  - _要件: 4.1, 5.1_

## フェーズ 15: React 基盤開発 (並列実行可能)

- [ ] 15.1 プロジェクトセットアップ

  - React + TypeScript プロジェクトセットアップを実装
  - ビルド設定と linting 設定を実装
  - _要件: 5.1_

- [ ] 15.2 スタイリング基盤

  - Tailwind CSS 設定とベースコンポーネントを実装
  - デザインシステムとテーマ設定を実装
  - _要件: 5.5_

- [ ] 15.3 API 統合

  - 自動生成された TypeScript 型定義を使用する API クライアントを実装
  - HTTP 通信とエラーハンドリングを実装
  - _要件: 5.1_

- [ ] 15.4 ルーティング
  - ルーティングと基本レイアウトを実装
  - ナビゲーションとページ構造を実装
  - _要件: 5.1_

## フェーズ 16: 検索 UI 開発

- [ ] 16.1 検索フォーム

  - 型安全な検索フォームとバリデーションを実装
  - リアルタイムサジェスト機能を実装
  - _要件: 5.1, 5.2_

- [ ] 16.2 結果表示

  - 自動生成型定義を使用した検索結果一覧表示コンポーネントを実装
  - ハイライト付き結果アイテムコンポーネントを実装
  - _要件: 5.2, 5.3_

- [ ] 16.3 ナビゲーション

  - ページネーションとフィルター UI を実装
  - ソート機能とビュー切り替えを実装
  - _要件: 5.3_

- [ ] 16.4 状態管理
  - 検索状態管理と URL 同期を実装
  - ローディング状態とエラーハンドリングを実装
  - _要件: 5.1_

## フェーズ 17: UI 最適化・多言語対応

- [ ] 17.1 多言語処理

  - 日本語・英語混在クエリ処理を実装
  - 言語検出と表示最適化を実装
  - _要件: 5.4_

- [ ] 17.2 レスポンシブデザイン

  - モバイル対応レスポンシブデザインを実装
  - タッチ操作とモバイル最適化を実装
  - _要件: 5.5_

- [ ] 17.3 アクセシビリティ

  - アクセシビリティ対応を実装
  - キーボードナビゲーションとスクリーンリーダー対応を実装
  - _要件: 5.5_

- [ ] 17.4 パフォーマンス最適化
  - 遅延読み込みとコード分割を実装
  - 画像最適化とキャッシュ戦略を実装
  - _要件: 5.5_

## フェーズ 18: 監視・観測性

- [ ] 18.1 APM 統合

  - New Relic APM エージェントを各 Python アプリケーションに統合
  - カスタムメトリクスとトレース設定を実装
  - _要件: 7.1_

- [ ] 18.2 インフラ監視

  - New Relic Infrastructure エージェントを EC2/ECS に設定
  - リソース監視とアラート設定を実装
  - _要件: 7.2_

- [ ] 18.3 ブラウザ監視

  - New Relic Browser 監視を React アプリケーションに統合
  - ユーザーエクスペリエンス監視を実装
  - _要件: 7.3_

- [ ] 18.4 ダッシュボード・アラート
  - カスタムダッシュボードとアラート設定を実装
  - AWS 統合 (CloudWatch メトリクス連携) を設定
  - _要件: 7.4_

## フェーズ 19: CI/CD・自動化

- [ ] 19.1 型定義同期

  - GitHub Actions で FastAPI 変更検知ワークフローを実装
  - Python 側の変更時に自動で TypeScript 型定義を生成・更新する機能を実装
  - _要件: 4.1, 5.1_

- [ ] 19.2 自動 PR 作成

  - 型定義の差分チェックとプルリクエスト自動作成を実装
  - コードレビュー自動化とマージ戦略を実装
  - _要件: 4.1, 5.1_

- [ ] 19.3 ビルド・デプロイ
  - フロントエンド側の型チェックとビルド検証を実装
  - 自動デプロイメントパイプラインを実装
  - _要件: 5.1_

## フェーズ 20: 品質評価・テスト

- [ ] 20.1 評価メトリクス

  - NDCG@10 と Recall@10 計算機能を実装
  - 品質メトリクス自動計算とレポート生成を実装
  - _要件: 8.1_

- [ ] 20.2 テストデータ

  - サンプルクエリセットとテストデータを作成
  - 評価用データセットとグラウンドトゥルースを作成
  - _要件: 8.1_

- [ ] 20.3 A/B テスト
  - A/B テスト用のログ収集機能を実装
  - 実験管理とデータ分析機能を実装
  - _要件: 8.3_

## フェーズ 21: 統合テスト・パフォーマンス

- [ ] 21.1 エンドツーエンドテスト

  - 型安全性を含むエンドツーエンドテストスイートを実装
  - クロール → インデックス → 検索の統合テストを実装
  - _要件: 8.2_

- [ ] 21.2 負荷テスト

  - 負荷テスト (100 QPS、P95 ≤ 500ms) を実装
  - ストレステストとボトルネック分析を実装
  - _要件: 4.5_

- [ ] 21.3 スケールテスト
  - 大量データテスト (5-10 万ドキュメント) を実装
  - スケーラビリティ検証とチューニングを実装
  - _要件: 2.3_

## フェーズ 22: セキュリティ・本番準備

- [ ] 22.1 WAF・セキュリティ

  - WAF 設定とセキュリティルールを Terraform で実装
  - DDoS 保護とレート制限を実装
  - _要件: 6.3_

- [ ] 22.2 権限最適化

  - IAM 権限の最小化と監査を実装
  - セキュリティスキャンと脆弱性対応を実装
  - _要件: 6.4_

- [ ] 22.3 運用準備
  - Secrets Manager 統合を実装
  - バックアップとディザスタリカバリ設定を実装
  - _要件: 6.3, 6.4_
